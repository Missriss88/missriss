import streamlit as st

# ★★★ 1. 긍정 8단계, 부정 8단계, 총 16단계로 궁합 데이터를 재구성했습니다. ★★★
def get_all_mbti_data():
    """16단계로 세분화된 모든 MBTI 조합 데이터를 반환합니다."""
    data = {
        # 각 MBTI 유형에 대해 15개 상대 유형과의 관계를 16단계로 재정의
        'INFP': {
            'ENFJ': '환상의 조합 (천생연분)', 'ENTJ': '완벽한 파트너', 'ENFP': '영혼의 단짝', 'INFP': '편안한 사이',
            'INFJ': '함께하면 성장하는', 'INTJ': '끈끈한 관계', 'ENTP': '매력적인 이끌림', 'INTP': '애증의 관계',
            'ESFJ': '서로 다른 세상', 'ISFJ': '끊임없는 노력 필요', 'ESFP': '예측불허 갈등', 'ISFP': '함께하면 성장하는',
            'ESTJ': '최악의 상극', 'ISTJ': '파국으로 치닫는', 'ESTP': '서로를 파괴하는', 'ISTP': '만나면 안 되는 사이'
        },
        'ENFP': {
            'INFJ': '환상의 조합 (천생연분)', 'INTJ': '완벽한 파트너', 'INFP': '영혼의 단짝', 'ENFP': '편안한 사이',
            'ENFJ': '함께하면 성장하는', 'ENTJ': '끈끈한 관계', 'INTP': '매력적인 이끌림', 'ENTP': '애증의 관계',
            'ISFJ': '서로 다른 세상', 'ESFJ': '끊임없는 노력 필요', 'ISFP': '예측불허 갈등', 'ESFP': '함께하면 성장하는',
            'ISTJ': '최악의 상극', 'ESTJ': '파국으로 치닫는', 'ISTP': '서로를 파괴하는', 'ESTP': '만나면 안 되는 사이'
        },
        'INFJ': {
            'ENFP': '환상의 조합 (천생연분)', 'ENTP': '완벽한 파트너', 'INFP': '함께하면 성장하는', 'INFJ': '편안한 사이',
            'ENFJ': '영혼의 단짝', 'ENTJ': '최상의 시너지', 'INTJ': '끈끈한 관계', 'INTP': '매력적인 이끌림',
            'ESTP': '최악의 상극', 'ISFP': '서로 다른 세상', 'ESFP': '파국으로 치닫는', 'ISTP': '만나면 안 되는 사이',
            'ESFJ': '함께하면 성장하는', 'ISFJ': '편안한 사이', 'ESTJ': '끊임없는 노력 필요', 'ISTJ': '애증의 관계'
        },
        'ENFJ': {
            'INFP': '환상의 조합 (천생연분)', 'INTP': '완벽한 파트너', 'ENFP': '함께하면 성장하는', 'ENFJ': '편안한 사이',
            'INFJ': '영혼의 단짝', 'INTJ': '최상의 시너지', 'ENTJ': '끈끈한 관계', 'ENTP': '매력적인 이끌림',
            'ISTP': '최악의 상극', 'ISFP': '환상의 조합 (천생연분)', 'ESFP': '함께하면 성장하는', 'ESTP': '파국으로 치닫는',
            'ISFJ': '함께하면 성장하는', 'ESFJ': '편안한 사이', 'ISTJ': '끊임없는 노력 필요', 'ESTJ': '애증의 관계'
        },
        'INTP': {
            'ENTJ': '환상의 조합 (천생연분)', 'ESTJ': '완벽한 파트너', 'ENTP': '영혼의 단짝', 'INTP': '편안한 사이',
            'INFP': '애증의 관계', 'ENFP': '매력적인 이끌림', 'INFJ': '끈끈한 관계', 'INTJ': '함께하면 성장하는',
            'ESFJ': '최악의 상극', 'ISFJ': '파국으로 치닫는', 'ESFP': '서로를 파괴하는', 'ISFP': '만나면 안 되는 사이',
            'ESTP': '편안한 사이', 'ISTP': '함께하면 성장하는', 'ENFJ': '완벽한 파트너', 'ISTJ': '최상의 시너지'
        },
        'ENTP': {
            'INFJ': '환상의 조합 (천생연분)', 'INTJ': '완벽한 파트너', 'ENFP': '영혼의 단짝', 'ENTP': '편안한 사이',
            'INTP': '영혼의 단짝', 'ENTJ': '함께하면 성장하는', 'INFP': '매력적인 이끌림', 'ENFJ': '끈끈한 관계',
            'ISFJ': '최악의 상극', 'ESFJ': '파국으로 치닫는', 'ISFP': '서로를 파괴하는', 'ESFP': '만나면 안 되는 사이',
            'ISTP': '편안한 사이', 'ESTP': '함께하면 성장하는', 'ISTJ': '최상의 시너지', 'ESTJ': '완벽한 파트너'
        },
        'INTJ': {
            'ENFP': '환상의 조합 (천생연분)', 'ENTP': '완벽한 파트너', 'INFP': '끈끈한 관계', 'INTJ': '편안한 사이',
            'INFJ': '끈끈한 관계', 'INTP': '함께하면 성장하는', 'ENTJ': '영혼의 단짝', 'ENFJ': '최상의 시너지',
            'ESFP': '최악의 상극', 'ISFP': '파국으로 치닫는', 'ESTP': '서로를 파괴하는', 'ISTP': '만나면 안 되는 사이',
            'ESTJ': '최상의 시너지', 'ISTJ': '함께하면 성장하는', 'ESFJ': '끊임없는 노력 필요', 'ISFJ': '애증의 관계'
        },
        'ENTJ': {
            'INFP': '환상의 조합 (천생연분)', 'INTP': '완벽한 파트너', 'ENTP': '함께하면 성장하는', 'ENTJ': '편안한 사이',
            'INTJ': '영혼의 단짝', 'ENFP': '끈끈한 관계', 'INFJ': '최상의 시너지', 'ENFJ': '끈끈한 관계',
            'ISFP': '최악의 상극', 'ESFP': '파국으로 치닫는', 'ISTP': '서로를 파괴하는', 'ESTP': '만나면 안 되는 사이',
            'ISTJ': '최상의 시너지', 'ESTJ': '함께하면 성장하는', 'ISFJ': '끊임없는 노력 필요', 'ESFJ': '애증의 관계'
        },
        'ISFP': {
            'ESFJ': '환상의 조합 (천생연분)', 'ESTJ': '완벽한 파트너', 'ENFJ': '환상의 조합 (천생연분)', 'ISFP': '편안한 사이',
            'ISFJ': '영혼의 단짝', 'ESFP': '함께하면 성장하는', 'ISTJ': '최상의 시너지', 'ESTP': '끈끈한 관계',
            'ENTJ': '최악의 상극', 'INTJ': '파국으로 치닫는', 'ENFP': '예측불허 갈등', 'INFP': '함께하면 성장하는',
            'INTP': '만나면 안 되는 사이', 'ENTP': '서로를 파괴하는', 'INFJ': '서로 다른 세상', 'ISTP': '애증의 관계'
        },
        'ESFP': {
            'ISFJ': '환상의 조합 (천생연분)', 'ISTJ': '완벽한 파트너', 'ESTJ': '최상의 시너지', 'ESFP': '편안한 사이',
            'ESFJ': '영혼의 단짝', 'ISFP': '함께하면 성장하는', 'ESTP': '끈끈한 관계', 'ISTP': '애증의 관계',
            'INTJ': '파국으로 치닫는', 'ENTJ': '최악의 상극', 'INFP': '예측불허 갈등', 'ENFP': '함께하면 성장하는',
            'ENTP': '만나면 안 되는 사이', 'INTP': '서로를 파괴하는', 'ENFJ': '함께하면 성장하는', 'INFJ': '서로 다른 세상'
        },
        'ISTP': {
            'ESTJ': '환상의 조합 (천생연분)', 'ESFJ': '완벽한 파트너', 'ENTJ': '서로를 파괴하는', 'ISTP': '편안한 사이',
            'ISTJ': '영혼의 단짝', 'ESTP': '함께하면 성장하는', 'ISFJ': '최상의 시너지', 'ESFP': '애증의 관계',
            'ENFJ': '최악의 상극', 'INFJ': '만나면 안 되는 사이', 'INFP': '만나면 안 되는 사이', 'ENFP': '서로를 파괴하는',
            'INTP': '함께하면 성장하는', 'ENTP': '편안한 사이', 'INTJ': '끊임없는 노력 필요', 'ISFP': '애증의 관계'
        },
        'ESTP': {
            'ISFJ': '환상의 조합 (천생연분)', 'ISTJ': '완벽한 파트너', 'ESFJ': '최상의 시너지', 'ESTP': '편안한 사이',
            'ESTJ': '영혼의 단짝', 'ISFP': '끈끈한 관계', 'ISTP': '함께하면 성장하는', 'ESFP': '끈끈한 관계',
            'INFJ': '최악의 상극', 'ENFJ': '파국으로 치닫는', 'ENFP': '만나면 안 되는 사이', 'INFP': '서로를 파괴하는',
            'ENTP': '함께하면 성장하는', 'INTP': '편안한 사이', 'INTJ': '서로 다른 세상', 'ENTJ': '끊임없는 노력 필요'
        },
        'ISFJ': {
            'ESFP': '환상의 조합 (천생연분)', 'ESTP': '완벽한 파트너', 'ISFJ': '편안한 사이', 'ESFJ': '함께하면 성장하는',
            'ISTJ': '끈끈한 관계', 'ISFP': '영혼의 단짝', 'ESTJ': '최상의 시너지', 'ISTP': '최상의 시너지',
            'ENTP': '최악의 상극', 'ENFP': '서로 다른 세상', 'ENTJ': '끊임없는 노력 필요', 'INTP': '파국으로 치닫는',
            'INFJ': '편안한 사이', 'INFP': '끊임없는 노력 필요', 'INTJ': '애증의 관계', 'ENFJ': '함께하면 성장하는'
        },
        'ESFJ': {
            'ISFP': '환상의 조합 (천생연분)', 'ISTP': '완벽한 파트너', 'ESFJ': '편안한 사이', 'ISFJ': '함께하면 성장하는',
            'ESFP': '영혼의 단짝', 'ESTP': '최상의 시너지', 'ISTJ': '최상의 시너지', 'ESTJ': '끈끈한 관계',
            'INTP': '최악의 상극', 'INFP': '서로 다른 세상', 'INTJ': '끊임없는 노력 필요', 'ENTP': '파국으로 치닫는',
            'ENFJ': '편안한 사이', 'ENTJ': '애증의 관계', 'ENFP': '끊임없는 노력 필요', 'INFJ': '함께하면 성장하는'
        },
        'ISTJ': {
            'ESFP': '환상의 조합 (천생연분)', 'ESTP': '완벽한 파트너', 'ISTJ': '편안한 사이', 'ESTJ': '함께하면 성장하는',
            'ISFJ': '끈끈한 관계', 'ISTP': '영혼의 단짝', 'ESFJ': '최상의 시너지', 'ISFP': '최상의 시너지',
            'ENFP': '최악의 상극', 'ENTP': '최상의 시너지', 'ENTJ': '최상의 시너지', 'INFP': '파국으로 치닫는',
            'INTJ': '함께하면 성장하는', 'INTP': '최상의 시너지', 'INFJ': '애증의 관계', 'ENFJ': '끊임없는 노력 필요'
        },
        'ESTJ': {
            'INTP': '환상의 조합 (천생연분)', 'ISTP': '완벽한 파트너', 'ESTJ': '편안한 사이', 'ISTJ': '함께하면 성장하는',
            'ESFJ': '끈끈한 관계', 'ENTP': '최상의 시너지', 'ISFP': '완벽한 파트너', 'ESFP': '최상의 시너지',
            'INFP': '최악의 상극', 'ENFP': '파국으로 치닫는', 'ISFJ': '최상의 시너지', 'ENFJ': '애증의 관계',
            'INFJ': '끊임없는 노력 필요', 'ENTJ': '함께하면 성장하는', 'INTJ': '최상의 시너지', 'ISFP': '완벽한 파트너'
        }
    }
    return data

# ★★★ 2. 16단계 관계에 대한 상세 설명과 레벨을 정의했습니다. ★★★
def get_compatibility_details(level):
    """궁합 레벨에 따른 상세 설명, 이모지, 점수를 반환합니다."""
    details = {
        # 긍정적 관계 (8단계)
        '환상의 조합 (천생연분)': {'score': 16, 'emoji': '💖', 'desc': '가치관, 성격, 취미 등 모든 면에서 완벽한 조화를 이루며, 서로를 통해 성장하는 최고의 관계입니다.'},
        '최상의 시너지': {'score': 15, 'emoji': '✨', 'desc': '서로의 강점을 극대화하고 약점을 보완하며, 함께할 때 엄청난 시너지를 발휘합니다.'},
        '영혼의 단짝': {'score': 14, 'emoji': '🥰', 'desc': '말하지 않아도 마음이 통하는 깊은 유대감을 형성하며, 서로에게 정서적 안식처가 되어줍니다.'},
        '완벽한 파트너': {'score': 13, 'emoji': '🤝', 'desc': '서로 다른 점이 오히려 매력으로 작용하며, 이상적인 파트너십을 구축할 수 있습니다.'},
        '끈끈한 관계': {'score': 12, 'emoji': '😊', 'desc': '안정적이고 신뢰가 깊어 시간이 지날수록 더욱 단단해지는 관계입니다.'},
        '함께하면 성장하는': {'score': 11, 'emoji': '🚀', 'desc': '서로에게 긍정적인 자극을 주며, 각자의 잠재력을 최대한으로 이끌어주는 관계입니다.'},
        '편안한 사이': {'score': 10, 'emoji': '🙂', 'desc': '오랜 친구처럼 편안하고 자연스러워, 함께 있으면 스트레스가 없는 관계입니다.'},
        '매력적인 이끌림': {'score': 9, 'emoji': '🤔', 'desc': '서로의 다른 점에 강하게 끌리지만, 그 차이를 이해하려는 노력이 필요한 관계입니다.'},
        # 부정적 관계 (8단계)
        '애증의 관계': {'score': 8, 'emoji': '💔', 'desc': '뜨겁게 사랑하지만, 동시에 서로에게 깊은 상처를 줄 수 있는 격렬하고 불안정한 관계입니다.'},
        '서로 다른 세상': {'score': 7, 'emoji': '🌍', 'desc': '가치관과 세계관이 너무 달라, 서로를 이해하기 어려운, 마치 다른 행성 사람 같은 관계입니다.'},
        '끊임없는 노력 필요': {'score': 6, 'emoji': '🚧', 'desc': '관계 유지를 위해 한쪽 또는 양쪽 모두의 엄청난 노력이 필요한, 쉽게 지칠 수 있는 관계입니다.'},
        '예측불허 갈등': {'score': 5, 'emoji': '🤯', 'desc': '사소한 오해가 큰 싸움으로 번지기 쉬우며, 갈등의 원인을 파악하기 어려운 관계입니다.'},
        '파국으로 치닫는': {'score': 4, 'emoji': '💥', 'desc': '사사건건 부딪히며, 관계가 지속될수록 부정적인 감정만 쌓여 파국을 맞이할 수 있습니다.'},
        '최악의 상극': {'score': 3, 'emoji': '👿', 'desc': '존재 자체가 서로에게 스트레스이며, 함께 있으면 서로의 에너지를 갉아먹는 최악의 조합입니다.'},
        '서로를 파괴하는': {'score': 2, 'emoji': '💣', 'desc': '서로의 자존감을 무너뜨리고, 잠재력을 억누르며, 관계가 서로에게 독이 되는 관계입니다.'},
        '만나면 안 되는 사이': {'score': 1, 'emoji': '⛔', 'desc': '가급적 마주치지 않는 것이 서로의 정신 건강에 이로운, 모든 관계의 최악입니다.'}
    }
    return details.get(level)

# --- Streamlit 앱 인터페이스 ---
st.set_page_config(page_title="MBTI 궁합 분석기 v2.0", page_icon="🔬")
st.title('🔬 MBTI 궁합 심층 분석기 v2.0 🔬')
st.caption('16단계 세분화된 관계로 더욱 정확하게 분석합니다.')

mbti_data = get_all_mbti_data()
mbti_types = list(mbti_data.keys())

col1, col2 = st.columns(2)
with col1:
    my_mbti = st.selectbox('**나의 MBTI 유형**', mbti_types, key='my_mbti')
with col2:
    partner_mbti = st.selectbox('**상대방의 MBTI 유형**', mbti_types, key='partner_mbti', index=3)

if st.button('🧬 심층 분석 결과 보기'):
    if my_mbti == partner_mbti:
        st.success("😎 자기 자신과의 관계는 언제나 '환상의 조합'이죠!")
    else:
        level = mbti_data.get(my_mbti, {}).get(partner_mbti, '데이터 없음')
        details = get_compatibility_details(level)
        
        st.write("---")
        st.subheader(f"{details['emoji']} {my_mbti}와(과) {partner_mbti}의 관계")
        
        # ★★★ 3. 궁합 점수와 레벨에 따라 시각적 요소를 다르게 표현합니다. ★★★
        st.metric(label="궁합 점수 (16점 만점)", value=f"{details['score']} 점")
        
        # 점수에 따라 프로그레스 바 색상 변경
        progress_value = details['score'] / 16.0
        if details['score'] > 12:
            st.progress(progress_value, text='💖 최상')
        elif details['score'] > 8:
            st.progress(progress_value, text='😊 좋음')
        elif details['score'] > 4:
            st.progress(progress_value, text='🚧 노력필요')
        else:
            st.progress(progress_value, text='⛔ 위험')

        # 결과 레벨에 따라 다른 스타일의 상자 사용
        if details['score'] >= 9:
            st.info(f"#### {level}")
        else:
            st.error(f"#### {level}")
        
        st.write(f"> {details['desc']}")